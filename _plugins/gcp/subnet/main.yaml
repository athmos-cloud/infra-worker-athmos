prerequisites:
  - message: "You must enable the Cloud Resource Manager API to use this plugin"
    action: gcloud services enable compute.googleapis.com --project ${project_id}
    condition:
      assert: gcloud services list --enabled --project $project_id | grep compute.googleapis.com | wc -l
      equals: 1
    with_values:
      - project_id
  - message: "You must grant the compute.networkAdmin role to the user service account to use this plugin"
    action: |
      gcloud organization add-iam-policy-binding $organization_name \
      --member="user:${user_service_account_email}" --role=roles/compute.networkAdmin"
    condition:
      assert: |
        gcloud projects get-iam-policy $project_id  --flatten="bindings[].members" --format='table(bindings.role)' \
        --filter="bindings.members:${user_service_account_email}" | \
        grep roles/compute.networkAdmin | wc -l
      equals: 1
    with_values:
      - project_id
      - user_service_account_email
      - organization_name
inputs:
  - name: identifier
    type: identifier
    displayName: "Identifier"
    required: true
    description: "The identifier of the subnetwork"
  - name: managed
    displayName: "Athmos Managed"
    type: bool
    default: true
    description: "Should the subnet be manageable by Athmos only"
    required: false
  - name: region
    displayName: "Region"
    type: string
    required: true
    description: "The region to which this subnetwork belongs"
  - name: ipCidrRange
    displayName: "IP CIDR Range"
    type: string
    required: true
    description: "The IP CIDR range of this subnetwork"

outputs:
  - name: ""
    object:
      kind: Project
      apiVersion: gcp.crossplane.io/v1beta1
    path: "metadata.name"

